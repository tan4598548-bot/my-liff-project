<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å•†å“ç®¡ç†ï¼ˆç‰ˆä¸»ï¼‰</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      background: #f7f7f7;
      padding: 12px;
    }
    h2 {
      margin-bottom: 8px;
    }
    .product {
      background: #fff;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,.08);
    }
    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
    }
    button {
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }
    .on { background: #2ecc71; color: #fff; }
    .off { background: #aaa; color: #fff; }
    .close { background: #e74c3c; color: #fff; }
    .badge {
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 4px;
      background: #ddd;
    }
  </style>
</head>

<body>
  <h2>ğŸ“¦ å•†å“ç®¡ç†</h2>
  <div id="list">è¼‰å…¥ä¸­â€¦</div>

<script>
const API_BASE = "https://line-group-buy-bot-api.onrender.com"; 
// â¬†ï¸ è‹¥ä½  Render ç¶²å€ä¸åŒï¼Œæ”¹é€™è£¡å³å¯

/* =========================
   LIFF åˆå§‹åŒ–
========================= */

async function init() {
  await liff.init({ liffId: "YOUR_LIFF_ID" }); // â† æ›æˆä½ çš„
  loadProducts();
}

/* =========================
   è¼‰å…¥å•†å“
========================= */

async function loadProducts() {
  const res = await fetch(`${API_BASE}/api/products`);
  const products = await res.json();

  const el = document.getElementById("list");
  el.innerHTML = "";

  products.forEach(p => {
    const div = document.createElement("div");
    div.className = "product";

    const statusText = p.closed === "TRUE"
      ? "ğŸ”’ å·²çµå–®"
      : (p.active === "TRUE" ? "ğŸŸ¢ ä¸Šæ¶ä¸­" : "âšª æœªä¸Šæ¶");

    div.innerHTML = `
      <strong>${p.productName}</strong>
      <div class="row">
        <span class="badge">${statusText}</span>
      </div>
      <div class="row">
        <button class="${p.active === "TRUE" ? "off" : "on"}"
          onclick="toggle('${p.productCode}', ${p.active !== "TRUE"})">
          ${p.active === "TRUE" ? "ä¸‹æ¶" : "ä¸Šæ¶"}
        </button>

        <button class="close"
          onclick="closeProduct('${p.productCode}')"
          ${p.closed === "TRUE" ? "disabled" : ""}>
          çµå–®
        </button>
      </div>
    `;

    el.appendChild(div);
  });
}

/* =========================
   ä¸Šä¸‹æ¶
========================= */

async function toggle(code, active) {
  await fetch(`${API_BASE}/api/product/active`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ productCode: code, active })
  });
  loadProducts();
}

/* =========================
   çµå–®ï¼ˆè‡ªå‹•æ–·è²¨ï¼‰
========================= */

async function closeProduct(code) {
  if (!confirm("ç¢ºå®šè¦çµå–®ï¼Ÿçµå–®å¾Œè²·å®¶å°‡ç„¡æ³•ä¸‹å–®")) return;

  await fetch(`${API_BASE}/api/product/close`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ productCode: code })
  });

  alert("å·²çµå–®ï¼Œè²·å®¶ç„¡æ³•å†ä¸‹å–®");
  loadProducts();
}

init();
</script>
</body>
</html>
