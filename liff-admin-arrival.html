<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>åˆ°è²¨é»è²¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      background: #f7f7f7;
      margin: 0;
      padding: 12px;
    }
    h2 {
      margin: 8px 0 12px;
    }
    .item {
      background: #fff;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }
    .row {
      display: flex;
      justify-content: space-between;
      margin: 4px 0;
      font-size: 14px;
    }
    .row strong {
      font-weight: 600;
    }
    input[type="number"] {
      width: 80px;
      padding: 4px;
    }
    .footer {
      margin-top: 16px;
    }
    button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      background: #06c755;
      color: #fff;
      border: none;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<h2>ğŸ“¦ åˆ°è²¨é»è²¨</h2>
<div id="list">è¼‰å…¥ä¸­â€¦</div>

<div class="footer">
  <button onclick="submitArrival()">âœ”ï¸ ç¢ºèªå·²å‹¾é¸åˆ°è²¨</button>
</div>

<script>
const API_BASE = '';

let arrivalData = [];

async function init() {
  await liff.init({ liffId: '2008857998-ePcCkr6K' });
  loadArrivalList();
}

async function loadArrivalList() {
  const res = await fetch('/api/admin/arrival');
  arrivalData = await res.json();

  const list = document.getElementById('list');
  list.innerHTML = '';

  arrivalData.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <div class="row">
        <strong>
          <input type="checkbox" id="chk_${index}">
          ${item.productName}
        </strong>
      </div>
      <div class="row">é¡è‰² / å°ºå¯¸ï¼š${item.color} / ${item.size}</div>
      <div class="row">è¨‚è³¼ç¸½æ•¸ï¼š${item.totalQty}</div>
      <div class="row">
        å¯¦éš›åˆ°è²¨æ•¸ï¼š
        <input type="number" min="0" id="qty_${index}" value="${item.totalQty}">
      </div>
    `;
    list.appendChild(div);
  });
}

async function submitArrival() {
  const payload = arrivalData.map((item, index) => ({
    productCode: item.productCode,
    color: item.color,
    size: item.size,
    arrived: document.getElementById(`chk_${index}`).checked,
    arrivedQty: Number(document.getElementById(`qty_${index}`).value || 0)
  })).filter(i => i.arrived);

  if (payload.length === 0) {
    alert('è«‹è‡³å°‘å‹¾é¸ä¸€é …å·²åˆ°è²¨å•†å“');
    return;
  }

  await fetch('/api/admin/arrival', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  });

  alert('å·²æ›´æ–°åˆ°è²¨ç‹€æ…‹');
  loadArrivalList();
}

init();
</script>
</body>
</html>
