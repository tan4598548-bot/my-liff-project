<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ç¾è²¨å‡ºæ¸…</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<h2>ğŸ”¥ ç¾è²¨å‡ºæ¸…ï¼ˆå…ˆåˆ°å…ˆè²·ï¼‰</h2>
<div id="list"></div>

<script>
let user;

liff.init({ liffId: "2008857998-LKw8W2JA" }).then(async () => {
  user = await liff.getProfile();
  load();
});

async function load() {
  const res = await fetch("/api/overstock/buyer");
  const items = await res.json();

  document.getElementById("list").innerHTML =
    items.map(i => `
      <div>
        <b>${i.product_name}</b><br>
        ${i.color} ${i.size}<br>
        $${i.price}ï¼ˆå‰© ${i.qty}ï¼‰<br>
        <button onclick="buy('${i.overstock_id}')">ç«‹å³è³¼è²·</button>
      </div><hr>
    `).join("");
}

async function buy(id) {
  const res = await fetch("/api/overstock/buyer/order", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      overstockId: id,
      buyerId: user.userId,
      buyerName: user.displayName
    })
  });
  const data = await res.json();
  alert(data.ok ? "è³¼è²·æˆåŠŸ" : data.error);
  load();
}
</script>
</body>
</html>
