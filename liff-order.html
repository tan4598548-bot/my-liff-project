<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>åœ˜è³¼ä¸‹å–®</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body {
      font-family: system-ui;
      background: #f6f6f6;
      padding: 12px;
    }
    .card {
      background: #fff;
      padding: 14px;
      border-radius: 12px;
      margin-bottom: 14px;
    }
    select, input {
      width: 100%;
      margin-top: 6px;
      padding: 8px;
    }
    button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      background: #06c755;
      color: #fff;
      border: none;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <h2>ğŸ›’ æˆ‘è¦ä¸‹å–®</h2>
  <div id="list"></div>

<script>
let userId = "";

async function init() {
  await liff.init({ liffId: "2008857998-imqg5sNq" });
  if (!liff.isLoggedIn()) liff.login();

  const profile = await liff.getProfile();
  userId = profile.userId;

  loadProducts();
}

async function loadProducts() {
  const res = await fetch("/api/admin/products/open");
  const products = await res.json();

  const box = document.getElementById("list");
  box.innerHTML = "";

  products.forEach(p => {
    const sizes = p.sizes || [];
    const colors = p.colors || [];

    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <b>${p.name}</b><br/>
      åƒ¹æ ¼ï¼š$${p.price}

      <select id="size-${p.code}">
        ${sizes.map(s => `<option>${s}</option>`).join("")}
      </select>

      <select id="color-${p.code}">
        ${colors.map(c => `<option>${c}</option>`).join("")}
      </select>

      <input id="qty-${p.code}" type="number" value="1" min="1" />

      <button onclick="order('${p.code}', ${p.price})">
        ä¸‹å–®
      </button>
    `;

    box.appendChild(div);
  });
}

async function order(code, price) {
  const body = {
    userId,
    productCode: code,
    size: document.getElementById(`size-${code}`).value,
    color: document.getElementById(`color-${code}`).value,
    qty: Number(document.getElementById(`qty-${code}`).value),
    price
  };

  const res = await fetch("/api/order/create", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body)
  });

  if (res.ok) {
    alert("ä¸‹å–®æˆåŠŸ");
  } else {
    alert("ä¸‹å–®å¤±æ•—");
  }
}

init();
</script>
</body>
</html>
