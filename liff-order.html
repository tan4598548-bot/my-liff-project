<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>å•†å“ä¸‹å–®</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
body { font-family: sans-serif; padding: 12px; }
.card {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 12px;
}
.card h3 { margin: 0 0 6px; }
.price { color: #d32f2f; font-weight: bold; }
button {
  margin-top: 8px;
  width: 100%;
  padding: 10px;
}
</style>
</head>

<body>
<h2>ğŸ›’ é–‹åœ˜å•†å“</h2>
<div id="list">è¼‰å…¥ä¸­â€¦</div>

<script>
async function init() {
  await liff.init({ liffId: "2008857998-imqg5sNq" });
  if (!liff.isLoggedIn()) {
    liff.login();
    return;
  }

  loadProducts();
}

async function loadProducts() {
  const res = await fetch("/api/products");
  const products = await res.json();

  const list = document.getElementById("list");
  list.innerHTML = "";

  products
    .filter(p => p.active === "TRUE")
    .forEach(p => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <h3>${p.productName}</h3>
        <div class="price">NT$ ${p.price}</div>
        <button onclick="openDetail('${p.productCode}')">
          æŸ¥çœ‹å•†å“ / ä¸‹å–®
        </button>
      `;
      list.appendChild(div);
    });
}

function openDetail(productCode) {
  liff.openWindow({
    url: `https://ä½ çš„ç¶²åŸŸ/liff/liff-product-detail.html?productCode=${productCode}`,
    external: false
  });
}

init();
</script>
</body>
</html>
