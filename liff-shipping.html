<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å‡ºè²¨ç®¡ç†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; background:#f7f7f7; padding:12px; }
    h2 { margin-bottom:10px; }
    .card { background:#fff; padding:10px; border-radius:8px; margin-bottom:8px; }
    button { padding:8px 12px; border-radius:6px; border:0; background:#06c755; color:#fff; }
    button.secondary { background:#555; }
  </style>
</head>
<body>

<h2>ğŸšš å‡ºè²¨ç®¡ç†</h2>

<div id="list"></div>

<button onclick="markShipped()">âœ… æ¨™è¨˜å‡ºè²¨ï¼‹å‡ºè²¨å–® PDF</button>
<br><br>
<button class="secondary" onclick="genPackingPdf()">ğŸ§¾ ç”¢ç”Ÿè²·å®¶æ€è²¨ PDF</button>

<script>
let orders = [];

async function init() {
  await liff.init({ liffId: "YOUR_LIFF_ID" });
  const res = await fetch("/api/admin/shipping-list");
  orders = await res.json();
  render();
}

function render() {
  const el = document.getElementById("list");
  el.innerHTML = "";
  orders.forEach(o => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <label>
        <input type="checkbox" value="${o.userId}_${o.productCode}">
        ${o.productName} Ã— ${o.qty}
      </label>
    `;
    el.appendChild(div);
  });
}

async function markShipped() {
  const ids = [...document.querySelectorAll("input:checked")].map(i => i.value);
  if (!ids.length) return alert("è«‹å…ˆå‹¾é¸");

  const res = await fetch("/api/admin/ship", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ orderIds: ids })
  });

  const data = await res.json();
  window.open(data.pdfUrl);
  location.reload();
}

async function genPackingPdf() {
  const res = await fetch("/api/admin/buyer-packing-pdf");
  const data = await res.json();
  if (!data.pdfUrl) return alert(data.error || "å¤±æ•—");
  window.open(data.pdfUrl);
}

init();
</script>
</body>
</html>
