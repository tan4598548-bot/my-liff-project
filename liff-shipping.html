<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å‡ºè²¨ç®¡ç†ï¼ˆLIFFï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; background:#f7f7f7; margin:0; padding:12px; }
    h2 { margin: 4px 0 12px; }
    .card { background:#fff; border-radius:8px; padding:12px; margin-bottom:10px; }
    .row { display:flex; justify-content:space-between; align-items:center; }
    button {
      padding:6px 12px; border:0; border-radius:6px;
      background:#06c755; color:#fff; cursor:pointer;
    }
    button.secondary { background:#888; }
    .muted { color:#666; font-size:13px; }
  </style>
</head>
<body>
  <h2>ğŸšš å‡ºè²¨å‹¾é¸</h2>

  <div id="list"></div>

  <div style="margin-top:12px;">
    <button onclick="markShipped()">âœ… æ¨™è¨˜å·²å‡ºè²¨ + ç”¢ PDF</button>
  </div>

<script>
let orders = [];

async function init() {
  await liff.init({ liffId: "YOUR_LIFF_ID" });
  const res = await fetch("/api/admin/shipping-list");
  orders = await res.json();
  render();
}

function render() {
  const el = document.getElementById("list");
  el.innerHTML = "";
  orders.forEach(o => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <div class="row">
        <label>
          <input type="checkbox" data-id="${o.orderId}">
          <b>${o.productName}</b>
        </label>
        <span>${o.color} Ã— ${o.qty}</span>
      </div>
      <div class="muted">${o.buyerName}</div>
    `;
    el.appendChild(div);
  });
}

async function markShipped() {
  const ids = [...document.querySelectorAll("input[type=checkbox]:checked")]
    .map(i => i.dataset.id);

  if (!ids.length) {
    alert("è«‹å…ˆå‹¾é¸å‡ºè²¨é …ç›®");
    return;
  }

  const res = await fetch("/api/admin/ship", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ orderIds: ids })
  });

  const data = await res.json();
  alert("å·²å®Œæˆå‡ºè²¨ï¼ŒPDF å·²ç”¢ç”Ÿ");
  window.open(data.pdfUrl);
  location.reload();
}

init();
</script>
</body>
</html>
